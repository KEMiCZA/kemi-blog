---
---

<button
  id="theme-toggle"
  class="hover:bg-accent-secondary hover:text-terminal-bg p-1 cursor-pointer transition-colors border border-transparent hover:border-terminal-bg flex items-center justify-center"
  aria-label="Toggle theme"
>
  <!-- Sun Icon (for Dark Mode -> Switch to Light) -->
  <svg id="sun-icon" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
  </svg>

  <!-- Moon Icon (for Light Mode -> Switch to Dark) -->
  <svg id="moon-icon" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
  </svg>
</button>

<script>
  const themeToggle = document.getElementById("theme-toggle");
  const sunIcon = document.getElementById("sun-icon");
  const moonIcon = document.getElementById("moon-icon");

  const getTheme = () => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
      return localStorage.getItem("theme");
    }
    return "dark"; // Default fallback if script in head failed somehow, but head script handles this.
  };

  const setTheme = (theme) => {
    if (theme === "light") {
      document.documentElement.classList.add("light");
    } else {
      document.documentElement.classList.remove("light");
    }
    localStorage.setItem("theme", theme);
    updateIcon(theme);
  };

  const updateIcon = (theme) => {
    if (sunIcon && moonIcon) {
        if (theme === 'dark') {
            // In Dark Mode, show Sun (to switch to Light)
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
        } else {
            // In Light Mode, show Moon (to switch to Dark)
            moonIcon.classList.remove('hidden');
            sunIcon.classList.add('hidden');
        }
    }
  }

  // Initial load - sync with what Head script did
  const initialTheme = document.documentElement.classList.contains("light") ? "light" : "dark";
  updateIcon(initialTheme);

  // Event listener
  themeToggle?.addEventListener("click", () => {
    const isLight = document.documentElement.classList.contains("light");
    setTheme(isLight ? "dark" : "light");
  });

  // Listen for view transitions
  document.addEventListener('astro:after-swap', () => {
    const currentTheme = localStorage.getItem("theme") || "dark";
    // Head script runs on swap too?
    // Astro view transitions might re-run head scripts if they are not persisted.
    // But `is:inline` scripts in head re-run.
    // However, just to be safe, we sync UI here.
    updateIcon(currentTheme);
  });
</script>
